{
  "hash": "41c9c4350a713b85666987569e869304",
  "result": {
    "markdown": "---\ntitle: \"Linear Mixed Models: Random Intercept and Slope\"\nauthor: \"Biostatistics Working Group\"\n---\n\n\n# LMM: Intercept & Slope {.unnumbered}\n\n## Overview\n\n<p>\n\nIn this example, we will use the **`LMM:ri`** to analyze trajectories of scores on the externalizing subscale of the child behavior checklist (CBCL) obtained across three measurement occasions in a sample of youth taking part in the ABCD Study. Our primary aim is to characterize stability and change in CBCL externalizing scores across assessments, while accounting for observations that are clustered within youth over time. To do so, we will use the **`LMM:ri`** to simultaneously model an overall sample mean trajectory (fixed effect) and subject-specific (random) effects that vary randomly about the sample mean trajectory. \n</p>\n\n## Preliminary Setup\n::: {.panel-tabset}\n### Install Packages {.tabset .tabset-fade .tabset-pills}\n<div class = \"blue\">\n\n> **This code installs the r packages necessary for this example, if they are not already installed**\n\n\n::: {.cell hash='3b_HowTos_LinearMixedModels_cache/html/unnamed-chunk-1_7b208a64d82d06b2bb7b0a6e8b6c2e74'}\n\n:::\n\n</div>\n\n### Load Packages\n<div class = \"blue\">\n\n> **This code loads the r libraries necessary for this example**\n\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/pckg-load_8cb1796cb1074dc2bb296c9b64071204'}\n\n```{.r .fold-hide .cell-code}\n#rm(list = ls())\n\n#Load packages\n#library(lme4)\n#library(lmerTest)\n#library(tidyverse)\n#library(afex)\n#library(janitor)\n#library(skimr)\n#library(sdamr)\n\nlibrary(lme4)\nlibrary(lmerTest)\nlibrary(tidyverse)\nlibrary(arrow)\nlibrary(afex)\nlibrary(janitor)\nlibrary(skimr)\nlibrary(sdamr)\nlibrary(formatR)\nlibrary(report)\nlibrary(easystats)\nlibrary(emmeans)\nlibrary(poorman)\nlibrary(parameters)\nlibrary(modelbased)\nlibrary(DT)\nlibrary(data.table)\nlibrary(arsenal)\nlibrary(kableExtra)\nlibrary(equatiomatic)\nlibrary(gtsummary)\n```\n:::\n\n\n</div>\n\n### Config Options\n<div class = \"blue\">\n\n**This code configures knitr code chunk options**\n\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/config_fcd478c6f74825dbb563adbce0ba8ece'}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = T, message=F, warning=F, error=F, \n                        comment=NA, cache=T, code_folding=T,\n                        R.options=list(width=220), fig.align='center',\n                        out.width='75%', fig.asp=.75)\n```\n:::\n\n</div>\n:::\n\n## Descriptives Overview\n::: {.panel-tabset}\n### Read and View Data {.tabset .tabset-fade .tabset-pills}\n<div class = \"blue\">\n\n**This code reads in and shows the data to be used in the current example**\n\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/read-data_1154d18fb575145b9eea371918118280'}\n\n```{.r .cell-code}\n## Read data\ndf_long<- read_csv(\"/Users/shawes/Desktop/data/df_long.csv\")\n#df_wide <- read_csv(\"/path/to/datafile\")\n\n# set types (if necessary)\n#df_long$x <- as.factor(df_long$x)\n#df_long$y <- as.numeric(df_long$y)\n```\n:::\n\n\n</div>\n\n### Descriptives\n<div class = \"blue\">\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/descriptives_b82866c928c92d42929b71f11881fe5f'}\n\n```{.r .cell-code}\n## Create a descriptives table of study variables by measurement occasion \ndescriptives_1  <- tableby.control(test=FALSE, total=FALSE,\n                               numeric.test=\"kwt\", cat.test=\"chisq\",\n                               numeric.stats=c(\"N\", \"meansd\", \"median\", \"range\" \n                                               ), #\"Nmiss2\"\n                               cat.stats=c(\"countpct\"), #\"Nmiss2\"\n                               stats.labels=list(N='Count', meansd=\"Mean (SD)\", median\n                                                 ='Median', range='Min - Max'\n                                                 )) #, Nmiss2 ='Missing'\n\nmy_cont_labels <- list(\n  age = \"Age\",\n  vg_total = \"Weekly # of Video Gaming Hrs\",\n  cbcl_extern = \"CBCL Externalizing Scale\"\n)\n\ntab_descriptives_1 <- tableby(event ~ age + vg_total + \n                            cbcl_extern,\n                            data=df_long, control=descriptives_1)\n\n#summary(tab_descriptives_1, labelTranslations = my_cont_labels , text=TRUE, title = #\"Continuous Outcomes\", term.name = TRUE)\n\n# Push table object through kable and kable_styling\ntab_descriptives_1 %>%\n  summary(text=TRUE, digits.pct=1, digits=1) %>%\n  kable(caption = \"Continuous Outcomes\") %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE, html_font = \"Cambria\",\n                font_size = 15,\n                position = \"center\", fixed_thead = T) %>%\n  row_spec(2:3,  bold = F, extra_css = 'vertical-align: middle !important;') %>%\n  column_spec(1, width = \"20em\", background = \"light grey\", bold = T, border_right = T) %>%\n  column_spec(2, width = \"20em\", border_right = T) %>%\n  column_spec(3, width = \"20em\", border_right = T) %>%\n  footnote(general = \"Here is a general comments of the table. \") %>%\n  scroll_box(width = \"75%\", height = \"500px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:75%; \"><table class=\"table table-striped\" style=\"font-size: 15px; font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n<caption style=\"font-size: initial !important;\">Continuous Outcomes</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\">  </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Baseline (N=35) </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Year_1 (N=34) </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Year_2 (N=30) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> age </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Count </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 35 </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 34 </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Mean (SD) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 9.3 (0.5) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 9.5 (0.5) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 9.6 (0.5) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Median </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 9.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 9.5 </td>\n   <td style=\"text-align:left;\"> 10.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Min - Max </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 9.0 - 10.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 9.0 - 10.0 </td>\n   <td style=\"text-align:left;\"> 9.0 - 10.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> vg_total </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Count </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 35 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 34 </td>\n   <td style=\"text-align:left;\"> 30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Mean (SD) </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 8.7 (8.4) </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 8.7 (8.1) </td>\n   <td style=\"text-align:left;\"> 6.8 (4.3) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Median </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 6.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 7.0 </td>\n   <td style=\"text-align:left;\"> 7.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Min - Max </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 - 28.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 - 28.0 </td>\n   <td style=\"text-align:left;\"> 1.0 - 16.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> cbcl_extern </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Count </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 35 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 34 </td>\n   <td style=\"text-align:left;\"> 30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Mean (SD) </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 4.8 (5.7) </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 5.5 (6.1) </td>\n   <td style=\"text-align:left;\"> 6.9 (6.9) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Median </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 3.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 4.0 </td>\n   <td style=\"text-align:left;\"> 4.5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Min - Max </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 - 21.0 </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 - 25.0 </td>\n   <td style=\"text-align:left;\"> 0.0 - 25.0 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Here is a general comments of the table. </td></tr>\n</tfoot>\n</table></div>\n\n`````\n:::\n:::\n\n</div>\n\n<div class = \"blue\">\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/catvar-table_f33eb1ff68995cc3fee4d88d8a5a7403'}\n\n```{.r .cell-code}\n## Create a descriptives table of study variables by measurement occasion \ndescriptives_2  <- tableby.control(test=FALSE, total=FALSE,\n                               numeric.test=\"kwt\", cat.test=\"chisq\",\n                               numeric.stats=c(\"N\", \"meansd\", \"median\", \"range\"\n                                               ), # \"Nmiss2\"\n                               cat.stats=c(\"countpct\"), # \"Nmiss2\"\n                               stats.labels=list(N='Count', meansd=\"Mean (SD)\", median\n                                                 ='Median', range='Min - Max'\n                                                 )) # , Nmiss2 ='Missing'\n\nmy_cat_labels  <- list(\n  event = \"Year\",\n  sex = \"Sex\",\n  mature_vg = \"Mature Video Games\"\n  )\n\ntab_descriptives_2 <- tableby(event ~ sex + mature_vg, \n                            data=df_long, control=descriptives_2)\n\n#summary(tab_descriptives_2, labelTranslations = my_cat_labels , text=TRUE, title = #\"Categorical Outcomes\", term.name = TRUE)\n\n# Push table object through kable and kable_styling\ntab_descriptives_2 %>%\n  summary(text=TRUE, digits.pct=1, digits=1) %>%\n  kable(caption = \"Categorical Outcomes\") %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE, font_size = 15,\n                position = \"center\", fixed_thead = T) %>%\n  row_spec(2:3,  bold = F, extra_css = 'vertical-align: middle !important;') %>%\n  column_spec(1, width = \"20em\", background = \"light grey\", bold = T, border_right = T) %>%\n  column_spec(2, width = \"20em\", border_right = T) %>%\n  #column_spec(3, width = \"20em\", border_right = T) %>%\n  footnote(general = \"Here is a general comments of the table. \") %>%\n  scroll_box(width = \"75%\", height = \"500px\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div style=\"border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:75%; \"><table class=\"table table-striped\" style=\"font-size: 15px; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0;\">\n<caption style=\"font-size: initial !important;\">Categorical Outcomes</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\">  </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Baseline (N=35) </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Year_1 (N=34) </th>\n   <th style=\"text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;\"> Year_2 (N=30) </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> sex </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Female </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 19 (54.3%) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 20 (58.8%) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 17 (56.7%) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Male </td>\n   <td style=\"text-align:left;vertical-align: middle !important;width: 20em; border-right:1px solid;\"> 16 (45.7%) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 14 (41.2%) </td>\n   <td style=\"text-align:left;vertical-align: middle !important;\"> 13 (43.3%) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> mature_vg </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n   <td style=\"text-align:left;\">  </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Count </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 35 </td>\n   <td style=\"text-align:left;\"> 34 </td>\n   <td style=\"text-align:left;\"> 30 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Mean (SD) </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.6 (0.9) </td>\n   <td style=\"text-align:left;\"> 1.7 (6.3) </td>\n   <td style=\"text-align:left;\"> 0.6 (0.9) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Median </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 </td>\n   <td style=\"text-align:left;\"> 0.0 </td>\n   <td style=\"text-align:left;\"> 0.0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;width: 20em; font-weight: bold;background-color: light grey !important;border-right:1px solid;\"> -  Min - Max </td>\n   <td style=\"text-align:left;width: 20em; border-right:1px solid;\"> 0.0 - 3.0 </td>\n   <td style=\"text-align:left;\"> 0.0 - 37.0 </td>\n   <td style=\"text-align:left;\"> 0.0 - 3.0 </td>\n  </tr>\n</tbody>\n<tfoot>\n<tr><td style=\"padding: 0; \" colspan=\"100%\"><span style=\"font-style: italic;\">Note: </span></td></tr>\n<tr><td style=\"padding: 0; \" colspan=\"100%\">\n<sup></sup> Here is a general comments of the table. </td></tr>\n</tfoot>\n</table></div>\n\n`````\n:::\n:::\n\n</div>\n:::\n  \n## Results\n    \n<div class = \"blue\">\n\n::: panel-tabset\n### Build Model {.tabset .tabset-fade .tabset-pills}\n  \n::: blue\n  \nThe code snippet below tells R to compute xxxxx by xxxxxxx. Next, xxxxx is conducted to examine whether xxxxxx does xxxxxxx (indicating xxxxx). The xxxx function (xxx) is provided by the r 'xxx' package.\nThe code above is very similar to the code for the random intercept model, except that now we use the code (1 + Days \\| Subject) to specify a random intercept for each Subject, and a random slope of Days for each Subject. This allows both the intercept and the slope of days to vary across participants.\n\n**STEP 1: Compute xxxxxxxx**\n\n::: {.cell hash='3b_HowTos_LinearMixedModels_cache/html/build-model-1_1da6a40f2f1e29fb0a24ab437b2bdf3c'}\n\n```{.r .fold-hide .cell-code}\n## Linear Mixed Model with a random intercept (LMM-ri)\n#really still an intercept only model\nrandom_slopes <- lmer(cbcl_extern ~ 1 + event + (1|ids), data = df_long, REML=F)\nprint(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by maximum likelihood  ['lmerModLmerTest']\nFormula: cbcl_extern ~ 1 + event + (1 | ids)\n   Data: df_long\n      AIC       BIC    logLik  deviance  df.resid \n 606.4845  619.4601 -298.2423  596.4845        94 \nRandom effects:\n Groups   Name        Std.Dev.\n ids      (Intercept) 4.881   \n Residual             3.528   \nNumber of obs: 99, groups:  ids, 37\nFixed Effects:\n(Intercept)  eventYear_1  eventYear_2  \n     4.5897       0.7558       1.7460  \n```\n:::\n:::\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/model-output_746785ee6aef6e9a45f61bf909e63335'}\n\n```{.r .cell-code  code-summary=\"testing\"}\nsummary(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by maximum likelihood . t-tests use Satterthwaite's\n  method [lmerModLmerTest]\nFormula: cbcl_extern ~ 1 + event + (1 | ids)\n   Data: df_long\n\n     AIC      BIC   logLik deviance df.resid \n   606.5    619.5   -298.2    596.5       94 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.7525 -0.4865 -0.1845  0.2842  2.9679 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n ids      (Intercept) 23.82    4.881   \n Residual             12.45    3.528   \nNumber of obs: 99, groups:  ids, 37\n\nFixed effects:\n            Estimate Std. Error      df t value Pr(>|t|)    \n(Intercept)   4.5897     1.0059 59.7864   4.563 2.56e-05 ***\neventYear_1   0.7558     0.8618 64.8217   0.877   0.3837    \neventYear_2   1.7460     0.9021 65.6574   1.935   0.0572 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) evnY_1\neventYear_1 -0.419       \neventYear_2 -0.401  0.475\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\n## Output and reports extending from the LMM-ri analyses\nsummary(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear mixed model fit by maximum likelihood . t-tests use Satterthwaite's\n  method [lmerModLmerTest]\nFormula: cbcl_extern ~ 1 + event + (1 | ids)\n   Data: df_long\n\n     AIC      BIC   logLik deviance df.resid \n   606.5    619.5   -298.2    596.5       94 \n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.7525 -0.4865 -0.1845  0.2842  2.9679 \n\nRandom effects:\n Groups   Name        Variance Std.Dev.\n ids      (Intercept) 23.82    4.881   \n Residual             12.45    3.528   \nNumber of obs: 99, groups:  ids, 37\n\nFixed effects:\n            Estimate Std. Error      df t value Pr(>|t|)    \n(Intercept)   4.5897     1.0059 59.7864   4.563 2.56e-05 ***\neventYear_1   0.7558     0.8618 64.8217   0.877   0.3837    \neventYear_2   1.7460     0.9021 65.6574   1.935   0.0572 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) evnY_1\neventYear_1 -0.419       \neventYear_2 -0.401  0.475\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\nconfint(random_slopes, level = 0.95, method = \"Wald\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                  2.5 %   97.5 %\n.sig01               NA       NA\n.sigma               NA       NA\n(Intercept)  2.61814609 6.561329\neventYear_1 -0.93332355 2.445020\neventYear_2 -0.02209218 3.514008\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\nreport(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nWe fitted a linear mixed model (estimated using ML and nloptwrap optimizer) to\npredict cbcl_extern with event (formula: cbcl_extern ~ 1 + event). The model\nincluded ids as random effect (formula: ~1 | ids). The model's total\nexplanatory power is substantial (conditional R2 = 0.66) and the part related\nto the fixed effects alone (marginal R2) is of 0.01. The model's intercept,\ncorresponding to event = Baseline, is at 4.59 (95% CI [2.59, 6.59], t(94) =\n4.56, p < .001). Within this model:\n\n  - The effect of event [Year_1] is statistically non-significant and positive\n(beta = 0.76, 95% CI [-0.96, 2.47], t(94) = 0.88, p = 0.383; Std. beta = 0.12,\n95% CI [-0.15, 0.40])\n  - The effect of event [Year_2] is statistically non-significant and positive\n(beta = 1.75, 95% CI [-0.05, 3.54], t(94) = 1.94, p = 0.056; Std. beta = 0.28,\n95% CI [-7.28e-03, 0.57])\n\nStandardized parameters were obtained by fitting the model on a standardized\nversion of the dataset. 95% Confidence Intervals (CIs) and p-values were\ncomputed using a Wald t-distribution approximation.\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\nreport_performance(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nThe model's total explanatory power is substantial (conditional R2 = 0.66) and\nthe part related to the fixed effects alone (marginal R2) is of 0.01\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\nreport_statistics(random_slopes)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nbeta = 4.59, 95% CI [2.59, 6.59], t(94) = 4.56, p < .001; Std. beta = -0.17, 95% CI [-0.50, 0.15]\nbeta = 0.76, 95% CI [-0.96, 2.47], t(94) = 0.88, p = 0.383; Std. beta = 0.12, 95% CI [-0.15, 0.40]\nbeta = 1.75, 95% CI [-0.05, 3.54], t(94) = 1.94, p = 0.056; Std. beta = 0.28, 95% CI [-7.28e-03, 0.57]\n```\n:::\n\n```{.r .cell-code  code-summary=\"testing\"}\nrandom <- estimate_grouplevel(random_slopes)\n```\n:::\n\n</div>\n\nThe summary function is used to print out the results from the random intercept model and\n\n**STEP 2: Conduct xxxxxxx**\n\n::: {.cell hash='3b_HowTos_LinearMixedModels_cache/html/build-model-2_f310f255431d1ae03758eda4fb57d638'}\n\n```{.r .fold-hide .cell-code}\n## Obtain LMM-ri model parameters to plot/graph of results\n## Fixed-Effects\nmodel_intercept <- rep(coef(random_slopes)$ids[,1], each = 4)\nslopes2 <- rep(coef(random_slopes)$ids[,2], each = 4)\n#This code allows for extracting the fixed effects estimates for the model intercept and slope.\n```\n:::\n\n\nThe output from our model provides: i. a parameter estimate; ii. standard error; iii. p-value. In our example p = .001 which is less than .05 indicating significant differences in predicted cbcl externalizing scores between boys and girls in the ABCD Study. An examination of the regression coeefficient for sex (female = 0; male = 1) is b = .xx, indicating the difference in cbcl externalizing scores from Time 1 to Time 2 is significantly greater in boys taking part in the ABCD Study relative to girls. Then we conclude that participant sex (does/does not) predict change in cbcl externalizing scores from t1 to t2.\n\nFrom the fixed effects section of the model summary, we can conclude that there is strong evidence that number of days of sleep deprivation significantly increased reaction time under a significance level of 0.05. On average, for each additional day of sleep deprivation, reaction time increased by 10.47ms (b = 10.47, SE = 1.55, p \\< .001).\n\nWe are 95% confident that the average increase was between 7.44 and 13.50.\n\nFrom the fixed effects section, we estimated the average intercept and average effect of days of sleep deprivation (slopes of Days). We also estimated the corresponding 95% confidence intervals. Using the results from the random effects section, we can calculate the coverage intervals for both the intercept and the slope.\n\nThe variance of the intercept and for the slope of Days is 612.1 and 35.1 respectively. Taking their square root, the corresponding standard deviations are 24.7 and 5.9. The 95% coverage interval of the intercept is 251.4 ± 1.96\\*24.7. The lower bound is 203.0 and the upper bound is 299.8. It is therefore estimated that 95% of the participants had a reaction time between 203.0 and 299.8 at Day 0.\n\nThe 95% coverage interval of the slope of Days is 10.5 ± 1.96\\*5.9. The lower bound is -1.1 and the upper bound is 22.1. It is therefore estimated that for 95% of the participants, the effect of each additional day of sleep deprivation was between -1.1 and 22.1. This is not to be confused with the 95% confidence interval (7.4 and 13.5), which means that we are 95% confident that average effect (across all participants) of each additional day of sleep deprivation on reaction time was between 7.4 and 13.5. The model now estimates a variance of the random slopes effects, as well as a correlation between the random intercept and slope effects. :::\n\n\n::: {.cell hash='3b_HowTos_LinearMixedModels_cache/html/unnamed-chunk-2_b53893363849c48651d18fa90e647388'}\n\n```{.r .cell-code}\n# # ! THIS PLOT RUNS & PRINTS TO SCREEN. I am temporarily commenting it out due to a side-effect of the \n# #\"intercepts2 variable\"\n# ggplot(df_long, aes(x = event, y = cbcl_extern)) + \n#   geom_abline(model_slope = slopes2, model_intercept = intercepts2, \n#               linetype = \"solid\", color = \"black\", linewidth = 1) + \n#   # geom_abline(mapping = aes(slopes2 = model_slope, intercepts2 = model_intercept, linetype = PID), \n#   #             linetype = \"dashed\", color = \"grey70\", linewidth = .4) +\n#   #geom_point(aes(shape = ids), size = 3.25, color = \"grey70\") + \n#   #scale_shape_manual() + \n#   # geom_segment(aes(x = event, xend = event, \n#   #                  y = cbcl1, yend = fitted(model_slope)), \n#   #              color = \"grey70\") +\n#   scale_y_continuous(expand = c(0, 0), breaks = c(0, 100, 200, 300, 400, 500), \n#                      limits = c(0, 500)) +\n#   scale_x_continuous(expand = c(0, 0), breaks = c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9), \n#                      limits = c(-0.5, 10.5)) +\n#   theme(panel.background = element_blank(),         \n#           panel.grid.major = element_blank(),\n#             panel.grid.minor = element_blank(),\n#             panel.border = element_rect(colour = \"black\", fill = NA),\n#           legend.position = \"none\", \n#           axis.text = element_text(size = 14),\n#           axis.title = element_text(size = 14)) +\n#     labs (x = \"event\", y = \"cbcl_extern\") \n#   \n# #Save the figure\n#  ggsave(\"random_slopes.png\", units = \"in\", width = 9, height = 6, dpi = 300)\n```\n:::\n\n  \n###   Model Plots\n    \n:::blue\n\n\n::: {.cell hash='3b_HowTos_LinearMixedModels_cache/html/diag-plots_0aa0b6f5394197c5b90cb1f5eee7f7f4'}\n\n```{.r .cell-code}\n# #| messages: FALSE\n# #| warning: FALSE\n# #| echo: FALSE\n# #| column: screen-inset-shaded\n# #| layout-nrow: 2\n#     \n# ## xxxxx plot\n# random_intercepts.std <- resid(model_intercept)/sd(resid(model_intercept))\n# plot (random_intercepts.std, ylab=\"Standardized Residuals\")\n# \n# ## Outlier Tests. \n# #car::outlierTest(random_intercepts)\n# car::infIndexPlot(random_intercepts)\n# \n# ## qqplot\n# ggplot(as.data.frame(random_intercepts.std), aes(sample = random_intercepts.std)) +\n#   geom_qq() +\n#   geom_qq_line()\n# \n# ## Predicted vs Actual plot\n# predicted <- estimate_expectation(random_intercepts, data = \"grid\")\n# plot(predicted)\n# \n# ## Estimated means plot\n# means <- estimate_means(random_intercepts)\n# plot(means)\n```\n:::\n\n\n#Build diagnostic plots. Observations with a Bonferroni p \\< .05 might\n#be considered as outliers and might need further investigation.\nExamination of this scatterplot indicates xxxxx.\n\n\n::: {.cell messages='false' hash='3b_HowTos_LinearMixedModels_cache/html/barplot_a45fd588ee52720d72bd2f592cfc0133'}\n\n```{.r .cell-code}\n# Basic ggplot2 barplot with mean\np <-df_long %>%\n    filter(!is.na(event)) %>% # filter on non-missing values  \n    ggplot(aes(x = mature_vg, y = cbcl_extern, fill = sex)) +\n    geom_col(position = \"dodge\",\n           stat = \"summary\",\n           fun = \"mean\",\n           #fill = \"#AA4A44\",\n           #color = \"#0099f9\"\n           ) +\n    #scale_fill_brewer(palette = \"Set1\") +\n    scale_fill_manual(values = c(\"#3db5ff\", \"#0099f9\")) +\n    #scale_fill_gradient(high = \"#B00B69\", low = \"#0e0e63\") +\n    #geom_text(aes(label = cu_traits), position = position_dodge(0.9), \n              #vjust = 2, size = 4, color = \"#ffffff\") +\n    labs(title = \"Behavior Problems by Video Game Groups\", subtitle = \"Simple bar chart\",\n         caption = \"Simple caption\", x = \"DBD Group\", y = \"CBCL Externalizing\") +\n              #coord_flip() +\n    #geom_hline(yintercept = mean(df$cbcl_agg), linetype = \"dashed\", size = 1) +\n    theme_minimal() +\n    theme(\n          plot.title = element_text(color = \"#0099f9\", size = 20, hjust = 0.5),\n          plot.subtitle = element_text(face = \"bold\", hjust = 1),\n          plot.caption = element_text(face = \"italic\", hjust = 0),\n            axis.title.x = element_text(color = \"#0099f9\", size = 15, face = \"bold\"),\n            axis.title.y = element_text(size = 15, face = \"italic\")\n    )\n```\n:::\n\n\nExamination of this scatterplot indicates xxxxx.\n    \n\n::: {.cell messages='false' fig.asp='0.61' hash='3b_HowTos_LinearMixedModels_cache/html/my-figure_7f7eba8ab712ca382ed65e323b789285'}\n\n```{.r .cell-code}\n#Random Intercept LMM Plot/Graph\n#random_intercepts <- lmer(Externalizing ~ 1 + Event + DBD + Sex + (1|ids), data = df, #REML=T)\n\n##  LMM-ri plot of estimated random intercepts \nmodel <- lmer(cbcl_extern ~ mature_vg + (1 | sex), data = df_long)\npreds <- estimate_relation(model, include_random = TRUE)\n    \n## Adding fixed effect trajectory to LMM-ri plot \nfixed_pred <- estimate_relation(model) # This time, include_random is FALSE (default)\n plot(preds, ribbon = list(alpha = 0)) + # Previous plot\n  geom_ribbon(data = fixed_pred, aes(x = mature_vg, ymin = CI_low, ymax = CI_high), alpha = 0.4) +\n  geom_line(data = fixed_pred, aes(x = mature_vg, y = Predicted), size = 2)\n```\n\n::: {.cell-output-display}\n![](3b_HowTos_LinearMixedModels_files/figure-html/my-figure-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# ggplot(df_long_sub, aes(x = event, y = cbcl_agg, color=sex, shape=sex)) + \n# geom_abline(slope = model_slope, intercept = model_intercept, linetype = \"solid\", color = \"red\", linewidth = 1) + \n# geom_point(color = \"grey70\") + \n# geom_smooth(method=lm, se=FALSE, fullrange=TRUE)+\n# scale_shape() + \n# geom_segment(aes(x = event, xend = event, y = cbcl_agg, yend = fitted(cbcl_agg)), color = \"grey70\") + \n# scale_y_continuous(expand = c(0, 0), breaks = c(0, 20, 40, 60, 80, 100), limits = c(0, 100)) + \n# scale_x_continuous(expand = c(0, 0), breaks = c(1, 2, 3, 4), limits = c(0, 4)) +\n# theme(panel.background = element_blank(),         \n#         panel.grid.major = element_blank(),\n#         panel.grid.minor = element_blank(),\n#         panel.border = element_rect(colour = \"black\", fill = NA),\n#         legend.position = \"none\",\n#         axis.text = element_text(size = 14), \n#         axis.title = element_text(size = 14)) +\n#         labs (x = \"Event\", y= \"CBCL Aggression\")\n\n#Save the plot\n#ggsave(\"random_intercept.png\", units = \"in\", width = 9, height = 6, dpi = 300)  \n```\n:::\n\n  \n<p class=\"text-center\" style=\"background-color: gray\">Figure x: The overall group-mean (fixed effects) trajectory is shown in blue. The faded lines represent each individual youth's estimated trajectory. An examination of this figure shows happiness scores to be increasing across measurement occasions, however, there appears to be substantial variability in the youth's initial happiness scores.</p>\n\nExamination of this barplot indicates xxxxx.\n\n## Wrapping Up\n<div class = \"blue\">\n\n<div class = \"blue\">\n\n::: panel-tabset\n### Write-up {.tabset .tabset-fade .tabset-pills}\n\n::: blue\n\nA random slope model is used to test if sleep deprivation affects reaction time. To account for the repeated measures design, a random intercept was specified for participants. The random slope for days of sleep deprivation was included in the model to allow the effect of sleep deprivation to vary across participants. Results are shown in Table 1. Using a significant level of 0.05, results indicate that sleep deprivation significantly increased reaction time. On average, each additional day of sleep deprivation increased reaction time by 10.47ms (b = 10.47, 95% CI = \\[7.44, 13.50\\], p \\< .001). Model fit comparison between model with and without random slope for sleep deprivation shows that the effect of sleep deprivation varied across participants, χ2(2)= 42.14, p \\< .001. The 95% coverage interval for the random slope of sleep deprivation is (-1.14, 22.07), indicating that the effect of sleep deprivation was between -1.14 and 22.07 for 95% of the participants.\n:::\n\n## References\n\n[@brown2021] <!-- [@Singmann2019]\n[@sarafian]\n[#@https://m-clark.github.io/]\n[#@Fitzmaurice]\n[#@mspeekenbrink.github.io]\n[#https://cran.r-project.org/web/packages/lme4/lme4.pdf] -->\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}